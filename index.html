<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>将棋 悪手アンケート</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="bar">
    <div class="brand">将棋 悪手アンケート</div>
  </header>

  <main class="wrap">

    <!-- ===== Step 0: 事前アンケート（経験） ===== -->
    <section class="panel" id="stepIntro">
      <h2 class="panelTitle">事前アンケート（将棋経験）</h2>

      <div class="note">
        <div class="noteTitle">最初に</div>
        <p>
          このアンケートは「同じ局面に対する 解説A と 解説B を比較する」ものです。<br>
          まずは簡単な属性（学籍番号・学年・将棋経験）だけ入力してください。
        </p>
      </div>

      <div class="formGrid">
        <label class="field">
          <span class="fieldLabel">学籍番号（必須）</span>
          <input id="studentNo" type="text" placeholder="例）1234567" />
        </label>

        <label class="field">
          <span class="fieldLabel">学年（必須）</span>
          <select id="grade">
            <option value="">選択してください</option>
            <option>1年</option><option>2年</option><option>3年</option><option>4年</option>
            <option>院1年</option><option>院2年</option><option>その他</option>
          </select>
        </label>

        <label class="field col2">
          <span class="fieldLabel">Q1. 将棋経験として最も近いもの（必須）</span>
          <select id="expLevel">
            <option value="">選択してください</option>
            <!-- ※ここは app.js 側でも同じ文字列を送ります -->
            <option>将棋はほとんど指したことがない（ルールもあいまい／対局経験がほぼない）</option>
            <option>将棋は少し指したことがある（たまに指す程度、継続的ではない）</option>
            <option>将棋を継続的に指している、または過去に継続的に指していた時期がある（オンライン／対面は問わない）</option>
            <option>将棋部・道場・大会参加など、継続的な活動経験がある（現在／過去を含む）</option>
          </select>
        </label>
      </div>

      <div class="actions">
        <button class="primary" id="introNext">次へ（局面1へ）</button>
      </div>

      <div class="smallHint">
        ※ ここではまだ送信しません。最後にまとめて1回だけ送信します。
      </div>
    </section>

    <!-- ===== Step 1..: 局面アンケート ===== -->
    <section class="panel hidden" id="stepCase">

      <div class="caseHeader">
        <h2 class="panelTitle" id="caseTitle">局面</h2>
        <div class="caseProgress" id="caseProgress"></div>
      </div>

      <div class="note strongNote">
        <div class="noteTitle">回答方法（必ず読んでください）</div>
        <ol class="rules">
          <li>
            まず <b>解説A → 解説B</b> の順に読んでください（この順番は固定）。<br>
            読んだら、下のアンケート（1〜5）に回答してください。<br>
            <span class="pill">1 = Aが分かりやすい</span>
            <span class="pill">3 = どちらともいえない</span>
            <span class="pill">5 = Bが分かりやすい</span>
          </li>
          <li>
            盤面は <b>「悪手後PV / 最善手後PV」</b> で切り替えできます。<br>
            PV（読み筋）はスライダー（← →）で局面を進めて確認できます。<br>
            <b>PVの操作は任意</b>です（見たい人だけ動かしてください）。
          </li>
          <li>
            回答が終わったら <b>「回答して次へ」</b> を押してください。戻るボタンはありません（重複回答防止のため）。
          </li>
        </ol>
      </div>

      <div class="viewerGrid">
        <!-- 左：盤面＋操作 -->
        <div class="viewer panelInner">
          <div class="row">
            <div class="seg">
              <button class="seg-btn active" id="btnBad">悪手後PV</button>
              <button class="seg-btn" id="btnBest">最善手後PV</button>
            </div>

            <div class="seg">
              <button class="seg-btn active" id="btnExpA">解説A <span class="seenMark" id="seenA">✓</span></button>
              <button class="seg-btn" id="btnExpB">解説B <span class="seenMark off" id="seenB">✓</span></button>
            </div>
          </div>

          <div class="imageBox">
            <img id="boardImg" alt="board" />
          </div>

          <div class="labelBox" id="frameLabel"></div>

          <div class="sliderRow">
            <button class="btn" id="prevBtn">←</button>
            <input id="frameSlider" type="range" min="0" max="0" value="0" step="1" />
            <button class="btn" id="nextBtn">→</button>
            <div class="small" id="frameCount"></div>
          </div>
        </div>

        <!-- 右：解説表示 -->
        <div class="panelInner">
          <div class="textBox">
            <div class="h" id="expTitle">解説A</div>
            <pre id="expText"></pre>
          </div>
        </div>
      </div>

      <!-- 評価フォーム -->
      <div class="survey">
        <h3 class="surveyTitle">解説評価アンケート</h3>

        <div class="surveyNote">
          <b>注意：</b> 解説A→解説Bの順に読んでから回答してください。<br>
          回答は <b>1（Aが分かりやすい）〜5（Bが分かりやすい）</b> の5段階です。
        </div>

        <div id="ratingQuestions"></div>

        <label class="field col2">
          <span class="fieldLabel">自由記述（任意）</span>
          <textarea id="freeText" placeholder="気づいた点、分かりにくかった点、改善案など"></textarea>
        </label>

        <div class="actions">
          <button class="primary" id="caseNext">回答して次へ</button>
        </div>

        <div class="smallHint" id="caseHint"></div>
      </div>
    </section>

    <!-- ===== Done ===== -->
    <section class="panel hidden" id="stepDone">
      <h2 class="panelTitle">送信しました</h2>
      <div class="note">
        <div class="noteTitle">ご協力ありがとうございました！</div>
        <p>
          回答は送信されました。画面は閉じて大丈夫です。
        </p>
      </div>
    </section>

  </main>

  <!-- GoogleフォームにPOSTするための隠しフォーム（CORS回避：iframe送信） -->
  <iframe name="hidden_iframe" class="hidden"></iframe>
  <form id="gform" class="hidden" method="POST" target="hidden_iframe">
    <input type="hidden" name="fvv" value="1" />
    <input type="hidden" name="fbzx" id="fbzx" value="" />
    <input type="hidden" name="pageHistory" id="pageHistory" value="" />
    <input type="hidden" name="submit" value="Submit" />
  </form>

  <script src="./app.js"></script>
</body>
</html>
